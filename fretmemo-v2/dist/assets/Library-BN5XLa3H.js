import{e as Y,u as V,i as W,m as Z,c as ee,a as te,r as l,j as t,S as k,T as O,g as F}from"./index-DeqRbqpk.js";import{u as q,E as R,C as ie}from"./exercise-card-Czr5CBzj.js";import{S as g,G as D}from"./section-collapse-Cbdec1Em.js";import{E as _}from"./empty-state-DYSlaySI.js";import{S as ne}from"./sparkles-Bpn5yPXr.js";import"./badge-DCK1EYBp.js";import"./mastery-bar-D-Z8g4T-.js";import"./clock-Bo7mvf6e.js";import"./chevron-down-B-UggeLX.js";const re=[["path",{d:"M6 8.5a6.5 6.5 0 1 1 13 0c0 6-6 6-6 10a3.5 3.5 0 1 1-7 0",key:"1dfaln"}],["path",{d:"M15 8.5a2.5 2.5 0 0 0-5 0v1a2 2 0 1 1 0 4",key:"1qnva7"}]],oe=Y("ear",re);const se=[["circle",{cx:"8",cy:"18",r:"4",key:"1fc0mg"}],["path",{d:"M12 18V2l7 4",key:"g04rme"}]],ae=Y("music-2",se),G={beginner:0,intermediate:1,advanced:2},H={spider:120,permutation:140,linear:140,diagonal:140,stringskip:160,legato:150},le=[{id:"fretboardToNote",title:"Fretboard → Note",difficulty:"beginner",priority:1,source:"train-drills-fretboard-to-note"},{id:"playNotes",title:"Note Names",difficulty:"beginner",priority:2,source:"train-drills-play-note-names"},{id:"noteToTab",title:"Note → Tab",difficulty:"intermediate",priority:3,source:"train-drills-note-to-tab"},{id:"tabToNote",title:"Tab → Note",difficulty:"intermediate",priority:4,source:"train-drills-tab-to-note"},{id:"playTab",title:"Tab Sequence",difficulty:"advanced",priority:5,source:"train-drills-play-tab-sequence"}],J="fretmemo.train.ui",b={pinned:!1,drills:!0,technique:!1,theory:!1,ear:!1};function K(i,o){return{pinned:typeof i?.pinned=="boolean"?i.pinned:o,drills:typeof i?.drills=="boolean"?i.drills:b.drills,technique:typeof i?.technique=="boolean"?i.technique:b.technique,theory:typeof i?.theory=="boolean"?i.theory:b.theory,ear:typeof i?.ear=="boolean"?i.ear:b.ear}}function L(){if(typeof window>"u")return null;try{const i=window.sessionStorage.getItem(J);if(!i)return null;const o=JSON.parse(i);if(!o||typeof o!="object")return null;const d=typeof o.scrollTop=="number"?Math.max(0,o.scrollTop):0;return{sectionsOpen:K(o.sectionsOpen,b.pinned),scrollTop:d}}catch{return null}}function z(i){if(!(typeof window>"u"))try{window.sessionStorage.setItem(J,JSON.stringify(i))}catch{}}const ce=[{id:"spider",title:"Spider Walk",difficulty:"beginner"},{id:"permutation",title:"Permutation Trainer",difficulty:"intermediate"},{id:"linear",title:"Linear Shifter",difficulty:"intermediate"},{id:"diagonal",title:"Diagonal Patterns",difficulty:"intermediate"},{id:"stringskip",title:"String Skipping",difficulty:"advanced"},{id:"legato",title:"Legato Builder",difficulty:"intermediate"}];function de(i,o){return H[i]?H[i]:o==="beginner"?120:o==="intermediate"?140:160}function X(i){return[...i].sort((o,d)=>{const p=G[o.difficulty]-G[d.difficulty];if(p!==0)return p;const f=o.priority??Number.MAX_SAFE_INTEGER,x=d.priority??Number.MAX_SAFE_INTEGER,N=f-x;if(N!==0)return N;const u=o.mastery-d.mastery;return u!==0?u:o.title.localeCompare(d.title)})}function Ne(){const i=V(),o=W(),d=Z(),p=ee(e=>e.modules.technique),{totalCorrect:f,totalIncorrect:x,sessionHistory:N}=te(),u=q(e=>e.pinnedIds),T=q(e=>e.maxPins),P=q(e=>e.togglePinned),$=N.length>0,w=l.useRef(null),S=l.useRef(!1),[m,Q]=l.useState(()=>{const e=L();return K(e?.sectionsOpen,u.length>0)}),B=l.useRef(m);l.useEffect(()=>{B.current=m;const e=w.current?.scrollTop??L()?.scrollTop??0;z({sectionsOpen:m,scrollTop:Math.max(0,e)})},[m]),l.useLayoutEffect(()=>{if(typeof window>"u")return;const e=document.getElementById("app-main-scroll");if(!(e instanceof HTMLElement)){S.current=!0;return}w.current=e;const r=o.state,n=d==="POP"||!!r?.restoreTrain,s=L();if(!n||!s||s.scrollTop<=0){S.current=!0;return}const a=Math.max(0,s.scrollTop),h=()=>{e.scrollTop=a,e.scrollTo({top:a,left:0,behavior:"auto"})};h();const C=window.requestAnimationFrame(h),M=window.setTimeout(h,60);return S.current=!0,()=>{window.cancelAnimationFrame(C),window.clearTimeout(M)}},[o.key,o.state,d]),l.useEffect(()=>{if(typeof window>"u")return;const e=w.current??document.getElementById("app-main-scroll");if(!(e instanceof HTMLElement))return;w.current=e;const r=()=>{S.current&&z({sectionsOpen:B.current,scrollTop:Math.max(0,e.scrollTop)})};return r(),e.addEventListener("scroll",r,{passive:!0}),()=>e.removeEventListener("scroll",r)},[]);const y=(e,r)=>{Q(n=>n[e]===r?n:{...n,[e]:r})},A=f+x>0?Math.round(f/(f+x)*100):0,j=l.useMemo(()=>{const e=le.map((r,n)=>({id:r.id,title:r.title,difficulty:r.difficulty,priority:r.priority,source:r.source,mastery:Math.max(0,A-n*8),isNew:!$}));return X(e)},[$,A]),v=l.useMemo(()=>{const e=p.bestBpm??{},r=p.sessionsCompleted??{},n=ce.map(s=>{const a=e[s.id]??0,h=de(s.id,s.difficulty),C=a>0?Math.min(100,Math.round(a/h*100)):0,M=r[s.id]??0;return{...s,mastery:C,isNew:M===0&&C===0}});return X(n)},[p.bestBpm,p.sessionsCompleted]),c=l.useMemo(()=>new Set(u),[u]),E=u.length>=T,I=l.useMemo(()=>{const e=new Map(j.map(n=>[n.id,n])),r=new Map(v.map(n=>[n.id,n]));return u.map(n=>{const s=e.get(n);if(s)return{id:n,kind:"drill",title:s.title,difficulty:s.difficulty,mastery:s.mastery,isNew:s.isNew,source:s.source};const a=r.get(n);return a?{id:n,kind:"technique",title:a.title,difficulty:a.difficulty,mastery:a.mastery,isNew:a.isNew}:null}).filter(n=>!!n)},[j,u,v]),U=(e,r)=>{i("/practice",{state:{openPreFlight:!0,source:r,mode:e}})};return t.jsxs("div",{className:"space-y-5 pb-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"type-display",children:"Train"}),t.jsx("p",{className:"mt-1 text-muted-foreground",children:"One catalog for fretboard drills, technique, theory, and ear training."})]}),t.jsx(g,{title:"Pinned",summary:`${I.length}/${T}`,open:m.pinned,onOpenChange:e=>y("pinned",e),children:I.length===0?t.jsx(_,{title:"No pinned exercises yet",description:"Pin your favorite drills with the star icon for quick access."}):t.jsx("div",{className:"grid grid-cols-1 gap-2 min-[360px]:grid-cols-2 min-[390px]:gap-2.5 min-[412px]:gap-3 lg:grid-cols-3",children:I.map(e=>t.jsxs("div",{className:"relative",children:[t.jsx("button",{type:"button",className:"absolute right-2 top-2 z-10 inline-flex h-7 w-7 items-center justify-center rounded-full border border-primary/40 bg-primary/10 text-primary shadow-sm transition hover:bg-primary/20",onClick:()=>P(e.id),"aria-label":`Unpin ${e.title}`,title:"Unpin",children:t.jsx(k,{className:"h-3.5 w-3.5 fill-current"})}),t.jsx(R,{title:e.title,difficulty:e.difficulty,mastery:e.mastery,icon:e.kind==="drill"?O:D,variant:"catalog",isNew:e.isNew,onClick:()=>e.kind==="drill"?U(e.id,e.source):i(`/technique/${e.id}`,{state:{fromTrain:!0}})})]},`pinned-${e.id}`))})}),t.jsx(g,{title:"Fretboard Drills",summary:`${j.length} modes`,open:m.drills,onOpenChange:e=>y("drills",e),children:t.jsx("div",{className:"grid grid-cols-1 gap-2 min-[360px]:grid-cols-2 min-[390px]:gap-2.5 min-[412px]:gap-3 lg:grid-cols-3",children:j.map(e=>t.jsxs("div",{className:"relative",children:[t.jsx("button",{type:"button",className:"absolute right-2 top-2 z-10 inline-flex h-7 w-7 items-center justify-center rounded-full border border-border bg-background/95 text-muted-foreground shadow-sm transition hover:border-primary/40 hover:text-primary disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>P(e.id),disabled:!c.has(e.id)&&E,"aria-label":c.has(e.id)?`Unpin ${e.title}`:`Pin ${e.title}`,title:!c.has(e.id)&&E?`Pin limit reached (${T})`:c.has(e.id)?"Unpin":"Pin",children:t.jsx(k,{className:F("h-3.5 w-3.5",c.has(e.id)&&"fill-current text-primary")})}),t.jsx(R,{title:e.title,difficulty:e.difficulty,mastery:e.mastery,icon:O,variant:"catalog",isNew:e.isNew,onClick:()=>U(e.id,e.source)})]},e.id))})}),t.jsx(g,{title:"Technique",summary:`${v.length} exercises`,open:m.technique,onOpenChange:e=>y("technique",e),children:t.jsx("div",{className:"grid grid-cols-1 gap-2 min-[360px]:grid-cols-2 min-[390px]:gap-2.5 min-[412px]:gap-3 lg:grid-cols-3",children:v.map(e=>t.jsxs("div",{className:"relative",children:[t.jsx("button",{type:"button",className:"absolute right-2 top-2 z-10 inline-flex h-7 w-7 items-center justify-center rounded-full border border-border bg-background/95 text-muted-foreground shadow-sm transition hover:border-primary/40 hover:text-primary disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>P(e.id),disabled:!c.has(e.id)&&E,"aria-label":c.has(e.id)?`Unpin ${e.title}`:`Pin ${e.title}`,title:!c.has(e.id)&&E?`Pin limit reached (${T})`:c.has(e.id)?"Unpin":"Pin",children:t.jsx(k,{className:F("h-3.5 w-3.5",c.has(e.id)&&"fill-current text-primary")})}),t.jsx(R,{title:e.title,difficulty:e.difficulty,mastery:e.mastery,icon:D,variant:"catalog",isNew:e.isNew,onClick:()=>i(`/technique/${e.id}`,{state:{fromTrain:!0}})})]},e.id))})}),t.jsx(g,{title:"Theory",summary:"coming soon",open:m.theory,onOpenChange:e=>y("theory",e),children:t.jsx(_,{title:"Theory Tools In Progress",description:"Scale explorer, chord maps, and fretboard theory visuals are on the roadmap.",icon:ae})}),t.jsx(g,{title:"Ear Training",summary:"coming soon",open:m.ear,onOpenChange:e=>y("ear",e),children:t.jsx(_,{title:"Ear Training In Progress",description:"Interval and chord recognition modules will appear here as soon as they are ready.",icon:oe})}),t.jsxs("div",{className:"rounded-xl border border-border bg-muted/40 p-4 text-sm text-muted-foreground",children:[t.jsx("p",{className:"font-medium text-foreground",children:"Suggested next"}),t.jsx("p",{className:"mt-1",children:"Continue with the mode that feels easiest today, then add one harder block."}),t.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-muted-foreground",children:[t.jsx(ie,{className:"h-3.5 w-3.5"}),t.jsx("span",{children:"Use short, focused sessions for faster retention."})]}),t.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-primary",children:[t.jsx(ne,{className:"h-3.5 w-3.5"}),t.jsx("span",{children:"Smart defaults are enabled in pre-session setup."})]})]})]})}export{Ne as default};
