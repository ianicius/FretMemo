import{u as se,a as ae,b as re,c as A,r as g,n as ne,j as e,F as ie,S as B,T as w,d as L,B as p}from"./index-8k3NHg1O.js";import{C as $,a as I,b as O,c as F,d as R}from"./card-DHuo3zQd.js";import{u as T,C as oe,A as le,E as _}from"./exercise-card-DA8XLM2v.js";import{E as H}from"./empty-state-CPOj4ARD.js";import{M as ce}from"./mastery-bar-DpVvEAwv.js";import{S as M}from"./stat-line-CYdmxyro.js";import{S as de}from"./sparkles-D1u3cylx.js";import{P as U}from"./play-Cg0uJj4I.js";import"./badge-dDcdEKhE.js";import"./clock-BksrT6E4.js";const me={spider:"Spider Walk",permutation:"Permutation Trainer",linear:"Linear Shifter",diagonal:"Diagonal Patterns",stringskip:"String Skipping",legato:"Legato Builder"},W={fretboardToNote:{title:"Fretboard → Note",difficulty:"beginner",source:"home-pinned-fretboard-to-note",masteryOffset:0},playNotes:{title:"Note Names",difficulty:"beginner",source:"home-pinned-note-names",masteryOffset:8},noteToTab:{title:"Note → Tab",difficulty:"intermediate",source:"home-pinned-note-to-tab",masteryOffset:16},tabToNote:{title:"Tab → Note",difficulty:"intermediate",source:"home-pinned-tab-to-note",masteryOffset:24},playTab:{title:"Tab Sequence",difficulty:"advanced",source:"home-pinned-tab-sequence",masteryOffset:32}},ue={spider:{title:"Spider Walk",difficulty:"beginner"},permutation:{title:"Permutation Trainer",difficulty:"intermediate"},linear:{title:"Linear Shifter",difficulty:"intermediate"},diagonal:{title:"Diagonal Patterns",difficulty:"intermediate"},stringskip:{title:"String Skipping",difficulty:"advanced"},legato:{title:"Legato Builder",difficulty:"intermediate"}},pe={spider:120,permutation:140,linear:140,diagonal:140,stringskip:160,legato:150};function fe(r){if(!r)return"New";const d=Date.parse(r);if(Number.isNaN(d))return"New";const o=Date.now()-d;if(o<6e4)return"Just now";const m=Math.floor(o/6e4);if(m<60)return`${m}m ago`;const u=Math.floor(m/60);if(u<24)return`${u}h ago`;const f=Math.floor(u/24);return f===1?"Yesterday":f<7?`${f} days ago`:new Date(r).toLocaleDateString()}function Me(){const r=se(),{streakDays:d,totalCorrect:o,totalIncorrect:m,positionStats:u}=ae(),{setMode:f,setPracticeConstraints:z}=re(),v=A(t=>t.quick.tuning),h=A(t=>t.modules.technique),P=T(t=>t.pinnedIds),Q=T(t=>t.maxPins),Y=T(t=>t.unpin),C=g.useMemo(()=>ne(v),[v]),E=Object.keys(u).length,G=C.length*12,b=Math.round(E/G*100),X=o+m>0||E>0,x=o+m>0?Math.round(o/(o+m)*100):0,y=o*10,J=Math.floor(y/1e3)+1,K=y%1e3/1e3*100,V=1e3-y%1e3,Z=d>1?`${d} days`:d===1?"1 day":"start",N=g.useMemo(()=>{const t=Date.now();return Object.entries(u).filter(([,s])=>s.total>=2).map(([s,a])=>{const n=a.correct/a.total,l=Math.min(1,a.total/10);let c=0;if(a.lastPracticed){const q=(t-Date.parse(a.lastPracticed))/36e5;c=Math.max(0,1-q/24)*.3}const S=n*l+c;return{key:s,stats:a,score:S}}).sort((s,a)=>s.score-a.score).map(({key:s,stats:a})=>[s,a])},[u])[0]??null,i=g.useMemo(()=>{if(!N)return null;const[t,s]=N,[a,n]=t.split("-").map(Number),l=Math.round(s.correct/s.total*100);return{stringIndex:a,fret:n,accuracy:l}},[N]),D=g.useMemo(()=>Object.entries(h.lastPracticedAt??{}).filter(([,s])=>!!s).sort((s,a)=>Date.parse(a[1])-Date.parse(s[1])).slice(0,2).map(([s,a])=>{const n=h.bestBpm?.[s]??0,l=n>0?Math.min(100,Math.round(n/140*100)):0;return{id:s,title:me[s]??"Technique Drill",mastery:l,lastPracticed:fe(a)}}),[h.bestBpm,h.lastPracticedAt]),j=g.useMemo(()=>P.map(t=>{if(t in W){const c=W[t];return{id:t,title:c.title,difficulty:c.difficulty,kind:"drill",source:c.source,mastery:Math.max(0,x-c.masteryOffset)}}const s=ue[t];if(!s)return null;const a=h.bestBpm?.[t]??0,n=pe[t]??140;return{id:t,title:s.title,difficulty:s.difficulty,kind:"technique",mastery:a>0?Math.min(100,Math.round(a/n*100)):0}}).filter(t=>!!t),[x,P,h.bestBpm]),ee=(t,s)=>{const a=Math.max(1,s-2),n=Math.min(12,s+2),l=Array.from({length:C.length},(c,S)=>Math.abs(S-t)<=1);z({fretRange:{min:a,max:n},enabledStrings:l})},k=(t,s)=>{f(t),r("/practice",{state:{openPreFlight:!0,source:s,mode:t}})},te=()=>{if(i){f("fretboardToNote"),ee(i.stringIndex,i.fret),r("/practice",{state:{openPreFlight:!0,source:"home-next-step-weak-spot",mode:"fretboardToNote"}});return}k("fretboardToNote","home-next-step-default")};return e.jsxs("div",{className:"space-y-6 pb-8",children:[e.jsxs("header",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"type-display",children:"Welcome back"}),e.jsxs("div",{className:"inline-flex items-center gap-4 rounded-full border border-border bg-muted/40 px-3 py-1.5 text-sm",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 font-medium text-foreground",children:[e.jsx(ie,{className:"h-4 w-4 text-amber-700 dark:text-amber-300"}),d]}),e.jsxs("span",{className:"inline-flex items-center gap-1 font-medium text-foreground",children:[e.jsx(B,{className:"h-4 w-4 text-primary"}),y]})]})]}),e.jsxs("div",{className:"rounded-xl border border-border bg-card p-4",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Level ",J]}),e.jsxs("span",{children:[V," XP to next level"]})]}),e.jsx(ce,{value:K,showLabel:!1})]})]}),e.jsxs($,{className:"border-gold-200 bg-gradient-to-br from-gold-50/90 via-amber-50/50 to-graphite-50 dark:border-amber-500/30 dark:from-amber-900/20 dark:via-slate-950 dark:to-slate-900",children:[e.jsxs(I,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5 text-primary"}),"Your Next Step"]}),e.jsx(F,{children:i?`Strings ${Math.max(1,i.stringIndex)}-${Math.min(6,i.stringIndex+2)}, frets ${Math.max(1,i.fret-2)}-${Math.min(12,i.fret+2)} need extra reps.`:"Start with a short fretboard drill to lock in note locations."})]}),e.jsxs(R,{className:"space-y-4",children:[X&&e.jsxs("div",{className:"grid gap-2 sm:grid-cols-3",children:[e.jsx(M,{icon:w,label:"Accuracy",value:`${x}%`,tone:x>=75?"success":x>=50?"warning":"danger"}),e.jsx(M,{icon:oe,label:"Coverage",value:`${b}%`,tone:b>=70?"success":b>=40?"warning":"danger"}),e.jsx(M,{icon:L,label:"Momentum",value:Z})]}),e.jsxs(p,{size:"lg",className:"w-full control-btn--primary justify-between",onClick:te,children:[e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),i?"Start Focused Practice":"Start First Drill"]}),e.jsx(le,{className:"h-4 w-4"})]})]})]}),e.jsxs($,{children:[e.jsxs(I,{children:[e.jsx(O,{className:"text-xl",children:"Today's Challenge"}),e.jsx(F,{children:"Lightning Round · 30 notes · +100 XP"})]}),e.jsxs(R,{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(p,{className:"control-btn--primary",onClick:()=>k("fretboardToNote","home-daily-challenge"),children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"Start Challenge"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Fast recall under light time pressure."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wide text-muted-foreground",children:"Pinned"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[j.length,"/",Q]})]}),j.length===0?e.jsx(H,{title:"No pinned exercises yet",description:"Pin your favorites in Train for quick access here.",ctaLabel:"Open Train",onCtaClick:()=>r("/train")}):e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:j.map(t=>e.jsxs("div",{className:"relative",children:[e.jsx(p,{type:"button",size:"icon",variant:"outline",className:"absolute right-2 top-2 z-10 h-7 w-7 rounded-full border-primary/40 bg-primary/10 text-primary hover:bg-primary/20",onClick:()=>Y(t.id),"aria-label":`Unpin ${t.title}`,title:"Unpin",children:e.jsx(B,{className:"h-3.5 w-3.5 fill-current"})}),e.jsx(_,{title:t.title,description:"Pinned quick launch.",difficulty:t.difficulty,mastery:t.mastery,icon:t.kind==="drill"?w:L,onClick:()=>t.kind==="drill"?k(t.id,t.source):r(`/technique/${t.id}`)})]},`pinned-home-${t.id}`))})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wide text-muted-foreground",children:"Continue"}),D.length===0?e.jsx(H,{title:"No recent technique sessions",description:"Open Train and pick a technique exercise to build consistency.",ctaLabel:"Open Train",onCtaClick:()=>r("/train")}):e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:D.map(t=>e.jsx(_,{title:t.title,description:"Resume where you left off.",difficulty:"intermediate",mastery:t.mastery,lastPracticedLabel:t.lastPracticed,icon:w,onClick:()=>r(`/technique/${t.id}`)},t.id))})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-wide text-muted-foreground",children:"Explore"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(p,{variant:"outline",onClick:()=>r("/train"),children:"Fretboard Drills"}),e.jsx(p,{variant:"outline",onClick:()=>r("/train"),children:"Technique"}),e.jsx(p,{variant:"outline",disabled:!0,title:"Coming soon",className:"cursor-not-allowed opacity-70",children:"Theory (Soon)"}),e.jsx(p,{variant:"outline",disabled:!0,title:"Coming soon",className:"cursor-not-allowed opacity-70",children:"Ear Training (Soon)"})]})]})]})}export{Me as default};
